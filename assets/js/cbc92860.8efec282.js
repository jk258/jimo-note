"use strict";(self.webpackChunkjimo=self.webpackChunkjimo||[]).push([[9215],{9909:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>r,contentTitle:()=>a,default:()=>p,frontMatter:()=>c,metadata:()=>o,toc:()=>l});var s=i(5893),t=i(1151);const c={},a="\u591a\u4efb\u52a1\u5f02\u6b65\u534f\u7a0b",o={id:"python/\u9ad8\u7ea7\u6559\u7a0b/3\u591a\u4efb\u52a1\u5f02\u6b65\u534f\u7a0b",title:"\u591a\u4efb\u52a1\u5f02\u6b65\u534f\u7a0b",description:"\u534f\u7a0b",source:"@site/docs/python/\u9ad8\u7ea7\u6559\u7a0b/3\u591a\u4efb\u52a1\u5f02\u6b65\u534f\u7a0b.md",sourceDirName:"python/\u9ad8\u7ea7\u6559\u7a0b",slug:"/python/\u9ad8\u7ea7\u6559\u7a0b/3\u591a\u4efb\u52a1\u5f02\u6b65\u534f\u7a0b",permalink:"/jimo-note/docs/python/\u9ad8\u7ea7\u6559\u7a0b/3\u591a\u4efb\u52a1\u5f02\u6b65\u534f\u7a0b",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/python/\u9ad8\u7ea7\u6559\u7a0b/3\u591a\u4efb\u52a1\u5f02\u6b65\u534f\u7a0b.md",tags:[],version:"current",frontMatter:{},sidebar:"pythonSidebar",previous:{title:"\u591a\u7ebf\u7a0b\u548c\u591a\u8fdb\u7a0b",permalink:"/jimo-note/docs/python/\u9ad8\u7ea7\u6559\u7a0b/2\u591a\u7ebf\u7a0b\u548c\u591a\u8fdb\u7a0b"},next:{title:"lxml\u6a21\u5757",permalink:"/jimo-note/docs/python/python\u5305/lxml\u6a21\u5757"}},r={},l=[{value:"\u534f\u7a0b",id:"\u534f\u7a0b",level:2},{value:"\u534f\u7a0b\u57fa\u672c\u8bed\u6cd5",id:"\u534f\u7a0b\u57fa\u672c\u8bed\u6cd5",level:2},{value:"\u534f\u7a0b\u5b9e\u4f8b",id:"\u534f\u7a0b\u5b9e\u4f8b",level:2},{value:"\u534f\u7a0b\u8fd4\u56de\u503c",id:"\u534f\u7a0b\u8fd4\u56de\u503c",level:2},{value:"aiohttp\u548caiofiles",id:"aiohttp\u548caiofiles",level:2}];function d(n){const e={code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h1,{id:"\u591a\u4efb\u52a1\u5f02\u6b65\u534f\u7a0b",children:"\u591a\u4efb\u52a1\u5f02\u6b65\u534f\u7a0b"}),"\n",(0,s.jsx)(e.h2,{id:"\u534f\u7a0b",children:"\u534f\u7a0b"}),"\n",(0,s.jsx)(e.p,{children:"\u5728\u7a0b\u5e8f\u9047\u5230\u4e86IO\u64cd\u4f5c\u65f6\uff0c\u4f1a\u4e3b\u52a8\u8ba9\u51faCPU\uff0c\u8ba9\u5176\u4ed6\u4efb\u52a1\u8fd0\u884c\uff0c\u5f53IO\u64cd\u4f5c\u5b8c\u6210\u540e\uff0c\u518d\u7ee7\u7eed\u6267\u884c\u4e4b\u524d\u88ab\u6253\u65ad\u7684\u4ee3\u7801\u3002"}),"\n",(0,s.jsx)(e.h2,{id:"\u534f\u7a0b\u57fa\u672c\u8bed\u6cd5",children:"\u534f\u7a0b\u57fa\u672c\u8bed\u6cd5"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"asyncio"}),":\u662f\u7528\u6765\u7f16\u5199\u5e76\u53d1\u4ee3\u7801\u7684\u5e93\uff0c\u4f7f\u7528",(0,s.jsx)(e.code,{children:"async/await"}),"\u8bed\u6cd5"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"import asyncio\n\nasync def func():\n  print('\u6211\u662f\u51fd\u6570')\n  \nif __name__ == '__main__':\n  # \u534f\u7a0b\u5bf9\u8c61\u60f3\u8981\u6267\u884c\uff0c\u5fc5\u987b\u501f\u52a9\u4e8eeventloop\n  # eventLoop = asyncio.get_event_loop()\n  # eventLoop.run_until_complete(func())\n  \n  # \u6216\u8005axync\u7684run\u65b9\u6cd5\n  asyncio.run(func())\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u534f\u7a0b\u5b9e\u4f8b",children:"\u534f\u7a0b\u5b9e\u4f8b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'import asyncio\n\n\nasync def func1():\n    print("\u6211\u662f\u51fd\u65701")\n    await asyncio.sleep(1)\n    print("\u51fd\u65701\u7ed3\u675f")\n\n\nasync def func2():\n    print("\u6211\u662f\u51fd\u65702")\n    await asyncio.sleep(2)\n    print("\u51fd\u65702\u7ed3\u675f")\n\n\nasync def func3():\n    print("\u6211\u662f\u51fd\u65703")\n    await asyncio.sleep(3)\n    print("\u51fd\u65703\u7ed3\u675f")\n\n\nasync def main():\n    f1 = asyncio.create_task(func1())\n    f2 = asyncio.create_task(func2())\n    f3 = asyncio.create_task(func3())\n    tasks = [f1, f2, f3]\n    await asyncio.wait(tasks)\n\n\nif __name__ == "__main__":\n    asyncio.run(main())\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u534f\u7a0b\u8fd4\u56de\u503c",children:"\u534f\u7a0b\u8fd4\u56de\u503c"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"asyncio.wait(tasks)"}),":\u8fd4\u56de",(0,s.jsx)(e.code,{children:"set"}),"\u96c6\u5408\uff0c\u6ca1\u6709\u987a\u5e8f","\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"done, pending = await asyncio.wait(tasks)\nfor t in done:\n    print(t.result())\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"asyncio.gather(tasks)"}),":\u8fd4\u56de",(0,s.jsx)(e.code,{children:"list"}),"\u96c6\u5408,\u6309\u7167\u6dfb\u52a0\u7684\u987a\u5e8f\u8fd4\u56de","\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"results = await asyncio.gather(f1, f2, f3,return_exceptions=True))\n"})}),"\n",(0,s.jsx)(e.code,{children:"return_exceptions"}),"\uff1a\u5f53\u534f\u7a0b\u629b\u51fa\u5f02\u5e38\u65f6\uff0c\u662f\u5426\u8fd4\u56de\u5f02\u5e38\u3002\u9ed8\u8ba4\u4e3a",(0,s.jsx)(e.code,{children:"False"}),",\u6709\u9519\u8bef\u4fe1\u606f\uff0c\u4efb\u52a1\u76f4\u63a5\u505c\u6b62\uff0c\u8bbe\u4e3a",(0,s.jsx)(e.code,{children:"True"}),"\u65f6\uff0c\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\uff0c\u5176\u4ed6\u4efb\u52a1\u6b63\u5e38\u6267\u884c"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"aiohttp\u548caiofiles",children:"aiohttp\u548caiofiles"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"aiohttp"}),"\u662f\u4e00\u4e2a\u4e3aPython\u63d0\u4f9b",(0,s.jsx)(e.code,{children:"\u5f02\u6b65HTTP"}),"\u5ba2\u6237\u7aef/\u670d\u52a1\u7aef\u7f16\u7a0b,\u57fa\u4e8e",(0,s.jsx)(e.code,{children:"asyncio"}),"\u7684\u5f02\u6b65\u5e93\u3002\u5728\u722c\u866b\u65f6\u63d0\u4f9b\u5f02\u6b65\u8bf7\u6c42"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"aiohttp-requests"}),"\u662f\u5bf9",(0,s.jsx)(e.code,{children:"aiohttp"}),"\u5e93\u7684\u7f51\u7edc\u8bf7\u6c42\u6a21\u5757\u7684\u5c01\u88c5"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"aiofiles"}),"\u7528\u4e8e\u5904\u7406",(0,s.jsx)(e.code,{children:"asyncio"}),"\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u672c\u5730\u78c1\u76d8\u6587\u4ef6\u3002\u722c\u866b\u8fc7\u7a0b\u4e2d\u7528\u5b83\u6765\u8fdb\u884c\u6587\u4ef6\u7684\u5f02\u6b65\u64cd\u4f5c"]}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u4e0b\u662f\u4e00\u4e2a",(0,s.jsx)(e.code,{children:"aiohttp"}),"\u548c",(0,s.jsx)(e.code,{children:"aiofiles"}),"\u4e0b\u8f7d\u56fe\u7247\u7684\u5b9e\u4f8b"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'import asyncio\nimport aiohttp\nimport aiofiles\n\nasync def download(url):\n    filename=f"{url.split(\'/\')[-1]}.jpg"\n    print(f"\u5f00\u59cb\u4e0b\u8f7d{filename}")\n    async with aiohttp.ClientSession() as session:\n        async with session.get(url) as response:\n            content= await response.read()\n            async with aiofiles.open(\'./img/\'+filename,\'wb\') as f:\n                await f.write(content)\n    print(f"{filename}\u4e0b\u8f7d\u5b8c\u6210")\n\nasync def main():\n    urlList = [\n        "https://img.cc0.cn/pixabay/2019102402030363713.jpg!cc0.cn.jpg",\n        "https://img.cc0.cn/pixabay/2019103118234746820.jpg!cc0.cn.jpg",\n        "https://img.cc0.cn/pixabay/201910221601026116.jpg!cc0.cn.jpg",\n        "https://img.cc0.cn/pixabay/2019102100481220373.jpg!cc0.cn.jpg",\n    ]\n    tasks = []\n    for url in urlList:\n        tasks.append(asyncio.create_task(download(url)))\n    await asyncio.wait(tasks)\n    \n\n\nif __name__ == "__main__":\n    asyncio.run(main())\n'})})]})}function p(n={}){const{wrapper:e}={...(0,t.a)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},1151:(n,e,i)=>{i.d(e,{Z:()=>o,a:()=>a});var s=i(7294);const t={},c=s.createContext(t);function a(n){const e=s.useContext(c);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:a(n.components),s.createElement(c.Provider,{value:e},n.children)}}}]);