"use strict";(self.webpackChunkjimo=self.webpackChunkjimo||[]).push([[2902],{8623:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var t=s(5893),i=s(1151);const r={},l=void 0,o={id:"python/\u6848\u4f8b/\u722c\u53d6m3u8\u89c6\u9891",title:"\u722c\u53d6m3u8\u89c6\u9891",description:"\u722c\u53d6m3u8\u89c6\u9891",source:"@site/docs/python/\u6848\u4f8b/\u722c\u53d6m3u8\u89c6\u9891.md",sourceDirName:"python/\u6848\u4f8b",slug:"/python/\u6848\u4f8b/\u722c\u53d6m3u8\u89c6\u9891",permalink:"/jimo-note/docs/python/\u6848\u4f8b/\u722c\u53d6m3u8\u89c6\u9891",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/python/\u6848\u4f8b/\u722c\u53d6m3u8\u89c6\u9891.md",tags:[],version:"current",frontMatter:{},sidebar:"pythonSidebar",previous:{title:"urllib",permalink:"/jimo-note/docs/python/python\u5305/urllib"}},a={},c=[{value:"\u722c\u53d6m3u8\u89c6\u9891",id:"\u722c\u53d6m3u8\u89c6\u9891",level:2},{value:"\u83b7\u53d6m3u8\u6587\u4ef6\u5e76\u4fdd\u5b58",id:"\u83b7\u53d6m3u8\u6587\u4ef6\u5e76\u4fdd\u5b58",level:2},{value:"\u901a\u8fc7\u5f02\u6b65\u7f16\u7a0b\u4e0b\u8f7d\u6240\u6709\u7684ts\u5206\u6bb5\u6587\u4ef6",id:"\u901a\u8fc7\u5f02\u6b65\u7f16\u7a0b\u4e0b\u8f7d\u6240\u6709\u7684ts\u5206\u6bb5\u6587\u4ef6",level:2},{value:"\u4e0b\u8f7d\u5b8c\u6210\u540e\u89e3\u5bc6ts\u6587\u4ef6",id:"\u4e0b\u8f7d\u5b8c\u6210\u540e\u89e3\u5bc6ts\u6587\u4ef6",level:2},{value:"\u628a\u89e3\u5bc6\u540e\u7684ts\u6587\u4ef6\u5408\u5e76\u6210mp4",id:"\u628a\u89e3\u5bc6\u540e\u7684ts\u6587\u4ef6\u5408\u5e76\u6210mp4",level:2}];function p(n){const e={br:"br",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h2,{id:"\u722c\u53d6m3u8\u89c6\u9891",children:"\u722c\u53d6m3u8\u89c6\u9891"}),"\n",(0,t.jsxs)(e.p,{children:["\u9996\u5148\uff0cm3u8\u89c6\u9891\u6587\u4ef6\uff0c\u662f\u5206\u6bb5\u7684\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u89e3\u6790m3u8\u6587\u4ef6\uff0c\u83b7\u53d6\u89c6\u9891\u7684\u5730\u5740\uff0c\u7136\u540e\u4e0b\u8f7d\u4e0b\u6765\uff0c\u6700\u540e\u5408\u5e76.",(0,t.jsx)(e.br,{}),"\n","m3us\u89c6\u9891\u6587\u4ef6\u5982\u4e0b\uff0c\u5176\u4e2d",(0,t.jsx)(e.code,{children:"METHOD"}),"\u662f\u52a0\u5bc6\u65b9\u5f0f\uff0c",(0,t.jsx)(e.code,{children:"URI"}),"\u662f\u52a0\u5bc6\u7684key\u6587\u4ef6\uff0c",(0,t.jsx)(e.code,{children:"IV"}),"\u662f\u52a0\u5bc6\u7684\u521d\u59cb\u5411\u91cf\uff0c",(0,t.jsx)(e.code,{children:"EXTINF"}),"\u662f\u6bcf\u4e2a\u89c6\u9891\u7684\u65f6\u957f"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'#EXTM3U\n#EXT-X-VERSION:3\n#EXT-X-TARGETDURATION:19\n#EXT-X-MEDIA-SEQUENCE:0\n#EXT-X-KEY:METHOD=AES-128,URI="enc.key",IV=0x00000000000000000000000000000000\n#EXTINF:10.416667,\nhttps://hnts.ymuuy.com:65/hls/125/20230802/1817669/plist0.ts\n#EXTINF:10.958333,\nhttps://hnts.ymuuy.com:65/hls/125/20230802/1817669/plist1.ts\n#EXTINF:10.125000,\nhttps://hnts.ymuuy.com:65/hls/125/20230802/1817669/plist2.ts\n#EXTINF:9.250000,\nhttps://hnts.ymuuy.com:65/hls/125/20230802/1817669/plist3.ts\n...\n'})}),"\n",(0,t.jsx)(e.h2,{id:"\u83b7\u53d6m3u8\u6587\u4ef6\u5e76\u4fdd\u5b58",children:"\u83b7\u53d6m3u8\u6587\u4ef6\u5e76\u4fdd\u5b58"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-py",children:'def getM3u8(iframeUrl):\n    response = requests.get(iframeUrl, headers)\n    response.encoding = "utf-8"\n    regex = re.compile(r"url: \'(?P<m3u8Url>.*?)\',", re.S)\n    m3u8Url = regex.search(response.text).group("m3u8Url")\n    res = requests.get(m3u8Url, headers)\n    with open("./m3u8.m3u8", "wb") as f:\n        f.write(res.content)\n'})}),"\n",(0,t.jsx)(e.h2,{id:"\u901a\u8fc7\u5f02\u6b65\u7f16\u7a0b\u4e0b\u8f7d\u6240\u6709\u7684ts\u5206\u6bb5\u6587\u4ef6",children:"\u901a\u8fc7\u5f02\u6b65\u7f16\u7a0b\u4e0b\u8f7d\u6240\u6709\u7684ts\u5206\u6bb5\u6587\u4ef6"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-py",children:'async def download(url):\n    for i in range(1, 10):\n        try:\n            async with aiohttp.ClientSession() as session:\n                async with session.get(url) as resp:\n                    content = await resp.content.read()\n                    filename = url.split("/")[-1]\n                    async with aiofiles.open(\n                        f"./\u7535\u5f71/{filename}", mode="wb"\n                    ) as f:\n                        print("\u5f00\u59cb\u5199\u5165", url)\n                        await f.write(content)\n            print("\u4e0b\u8f7d\u6210\u529f", url)\n            break\n        except:\n            print("\u4e0b\u8f7d\u5931\u8d25", url)\n            await asyncio.sleep((i + 1) * 5)\n            break\n\nasync def downMovie():\n    tasks = []\n    with open("./m3u8.m3u8", "r") as f:\n        lines = f.readlines()\n        for line in lines:\n            if ".ts" in line:\n                url = line.strip()\n                tasks.append(asyncio.ensure_future(download(url)))\n        await asyncio.gather(*tasks)\n'})}),"\n",(0,t.jsx)(e.p,{children:"ps:\u5728\u8fd9\u91cc\uff0c\u540c\u65f6\u53d1\u9001\u592a\u591a\u6587\u4ef6\u53ef\u80fd\u5bfc\u81f4\u5931\u8d25\uff0c\u5982\u679c\u4e0b\u8f7d\u5931\u8d25\uff0c\u8bf7\u7b49\u5f85\u51e0\u79d2\u949f\uff0c\u7136\u540e\u91cd\u65b0\u4e0b\u8f7d\u3002"}),"\n",(0,t.jsx)(e.h2,{id:"\u4e0b\u8f7d\u5b8c\u6210\u540e\u89e3\u5bc6ts\u6587\u4ef6",children:"\u4e0b\u8f7d\u5b8c\u6210\u540e\u89e3\u5bc6ts\u6587\u4ef6"}),"\n",(0,t.jsx)(e.p,{children:"\u5b89\u88c5pycryptodome"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pip install pycryptodome\n"})}),"\n",(0,t.jsxs)(e.p,{children:["\u901a\u8fc7",(0,t.jsx)(e.code,{children:"from Crypto.Cipher import AES"}),"\u5f15\u5165",(0,t.jsx)(e.code,{children:"AES"}),"\u89e3\u5bc6ts\u6587\u4ef6"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-py",children:'headers = {\n    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"\n}\n\n\ndef getKey(url):\n    res = requests.get(url)\n    return res.text\n\n# \u5f02\u6b65\u89e3\u5bc6ts\u6587\u4ef6\nasync def decodeTs(file, key):\n    print("\u5f00\u59cb\u89e3\u5bc6", file)\n    aes = AES.new(\n        key=key.encode(),\n        IV=b"0000000000000000",\n        mode=AES.MODE_CBC,\n    )\n    async with aiofiles.open(f"\u7535\u5f71/{file}", "rb") as f, aiofiles.open(\n        f"\u7535\u5f71\u89e3\u5bc6/{file}", "wb"\n    ) as fw:\n        content = await f.read()\n        bsCon = aes.decrypt(content)\n        await fw.write(bsCon)\n        print("\u89e3\u5bc6\u5b8c\u6210", file)\n\n# \u8bfb\u53d6m3u8\u6587\u4ef6\uff0c\u83b7\u53d6key\u5e76\u6839\u636ekey\u89e3\u5bc6ts\u6587\u4ef6\nasync def main():\n    keyUrl = ""\n    IV = ""\n    tasks = []\n    with open("./m3u8.m3u8", "r", encoding="utf-8") as f:\n        lines = f.readlines()\n        urls = "".join(lines)\n\n        regex = re.compile(r\'URI="(?P<keyUrl>.*?)"\')\n        keyUrl = regex.search(urls).group("keyUrl")\n        keyUrl = "https://hnzy.bfvvs.com/play/YaOR6mBe/enc.key"\n\n        regexIv = re.compile(r"IV=(?P<IV>.*?)\\n")\n        IV = regexIv.search(urls).group("IV")\n        key = getKey(keyUrl)\n        for line in lines:\n            if ".ts" in line:\n                tasks.append(decodeTs(line.split("/")[-1].strip(), key, IV))\n    await asyncio.gather(*tasks)\n'})}),"\n",(0,t.jsx)(e.h2,{id:"\u628a\u89e3\u5bc6\u540e\u7684ts\u6587\u4ef6\u5408\u5e76\u6210mp4",children:"\u628a\u89e3\u5bc6\u540e\u7684ts\u6587\u4ef6\u5408\u5e76\u6210mp4"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'def mergeMovive():\n    urls = []\n    with open("./m3u8.m3u8", "r", encoding="utf-8") as f:\n        for line in f:\n            if ".ts" in line:\n                urls.append(line.split("/")[-1].strip())\n    temp = []\n    n = 1\n    for i in range(len(urls)):\n        name = urls[i]\n        temp.append(f".\\\\\u7535\u5f71\u89e3\u5bc6\\\\{name}")\n        if i != 0 and i % 50 == 0:\n            names = "+".join(temp)\n            os.system(f"copy /b {names} {n}.ts")\n            n += 1\n            temp = []\n    names = "+".join(temp)\n    os.system(f"copy /b {names} {n}.ts")\n    n+=1\n    tempm = []\n    for i in range(1, n):\n        tempm.append(f"{i}.ts")\n    print(tempm)\n    namem = "+".join(tempm)\n    print(namem)\n    os.system(f"copy /b {namem} movie.mp4")\n'})}),"\n",(0,t.jsx)(e.p,{children:"ps"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u4f7f\u7528",(0,t.jsx)(e.code,{children:"os.system"}),"\u5408\u5e76\u6587\u4ef6\u65f6\u8def\u5f84\u4e0d\u80fd\u592a\u957f\uff0c\u53ef\u5206\u6279\u5408\u5e76"]}),"\n",(0,t.jsxs)(e.li,{children:["linx\u5408\u5e76\u8bed\u6cd5\u4e3a",(0,t.jsx)(e.code,{children:"cat file1 file2 > newfile"}),",windows\u5408\u5e76\u8bed\u6cd5\u4e3a",(0,t.jsx)(e.code,{children:"copy /b file1+file2 newfile"})]}),"\n",(0,t.jsxs)(e.li,{children:["\u5728windos\u4e0a\u5408\u5e76\u65f6\u4f7f\u7528",(0,t.jsx)(e.code,{children:"cmd"})]}),"\n"]})]})}function d(n={}){const{wrapper:e}={...(0,i.a)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(p,{...n})}):p(n)}},1151:(n,e,s)=>{s.d(e,{Z:()=>o,a:()=>l});var t=s(7294);const i={},r=t.createContext(i);function l(n){const e=t.useContext(r);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:l(n.components),t.createElement(r.Provider,{value:e},n.children)}}}]);