"use strict";(self.webpackChunkjimo=self.webpackChunkjimo||[]).push([[2902],{3905:(e,n,t)=>{t.d(n,{Zo:()=>m,kt:()=>d});var r=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var o=r.createContext({}),p=function(e){var n=r.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},m=function(e){var n=p(e.components);return r.createElement(o.Provider,{value:n},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},f=r.forwardRef((function(e,n){var t=e.components,i=e.mdxType,a=e.originalType,o=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),u=p(t),f=i,d=u["".concat(o,".").concat(f)]||u[f]||c[f]||a;return t?r.createElement(d,s(s({ref:n},m),{},{components:t})):r.createElement(d,s({ref:n},m))}));function d(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var a=t.length,s=new Array(a);s[0]=f;var l={};for(var o in n)hasOwnProperty.call(n,o)&&(l[o]=n[o]);l.originalType=e,l[u]="string"==typeof e?e:i,s[1]=l;for(var p=2;p<a;p++)s[p]=t[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,t)}f.displayName="MDXCreateElement"},1030:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>c,frontMatter:()=>a,metadata:()=>l,toc:()=>p});var r=t(7462),i=(t(7294),t(3905));const a={},s=void 0,l={unversionedId:"python/\u6848\u4f8b/\u722c\u53d6m3u8\u89c6\u9891",id:"python/\u6848\u4f8b/\u722c\u53d6m3u8\u89c6\u9891",title:"\u722c\u53d6m3u8\u89c6\u9891",description:"\u722c\u53d6m3u8\u89c6\u9891",source:"@site/docs/python/\u6848\u4f8b/\u722c\u53d6m3u8\u89c6\u9891.md",sourceDirName:"python/\u6848\u4f8b",slug:"/python/\u6848\u4f8b/\u722c\u53d6m3u8\u89c6\u9891",permalink:"/jimo-note/docs/python/\u6848\u4f8b/\u722c\u53d6m3u8\u89c6\u9891",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/python/\u6848\u4f8b/\u722c\u53d6m3u8\u89c6\u9891.md",tags:[],version:"current",frontMatter:{},sidebar:"pythonSidebar",previous:{title:"urllib",permalink:"/jimo-note/docs/python/python\u5305/urllib"}},o={},p=[{value:"\u722c\u53d6m3u8\u89c6\u9891",id:"\u722c\u53d6m3u8\u89c6\u9891",level:2},{value:"\u83b7\u53d6m3u8\u6587\u4ef6\u5e76\u4fdd\u5b58",id:"\u83b7\u53d6m3u8\u6587\u4ef6\u5e76\u4fdd\u5b58",level:2},{value:"\u901a\u8fc7\u5f02\u6b65\u7f16\u7a0b\u4e0b\u8f7d\u6240\u6709\u7684ts\u5206\u6bb5\u6587\u4ef6",id:"\u901a\u8fc7\u5f02\u6b65\u7f16\u7a0b\u4e0b\u8f7d\u6240\u6709\u7684ts\u5206\u6bb5\u6587\u4ef6",level:2},{value:"\u4e0b\u8f7d\u5b8c\u6210\u540e\u89e3\u5bc6ts\u6587\u4ef6",id:"\u4e0b\u8f7d\u5b8c\u6210\u540e\u89e3\u5bc6ts\u6587\u4ef6",level:2},{value:"\u628a\u89e3\u5bc6\u540e\u7684ts\u6587\u4ef6\u5408\u5e76\u6210mp4",id:"\u628a\u89e3\u5bc6\u540e\u7684ts\u6587\u4ef6\u5408\u5e76\u6210mp4",level:2}],m={toc:p},u="wrapper";function c(e){let{components:n,...t}=e;return(0,i.kt)(u,(0,r.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"\u722c\u53d6m3u8\u89c6\u9891"},"\u722c\u53d6m3u8\u89c6\u9891"),(0,i.kt)("p",null,"\u9996\u5148\uff0cm3u8\u89c6\u9891\u6587\u4ef6\uff0c\u662f\u5206\u6bb5\u7684\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u89e3\u6790m3u8\u6587\u4ef6\uff0c\u83b7\u53d6\u89c6\u9891\u7684\u5730\u5740\uff0c\u7136\u540e\u4e0b\u8f7d\u4e0b\u6765\uff0c\u6700\u540e\u5408\u5e76.",(0,i.kt)("br",{parentName:"p"}),"\n","m3us\u89c6\u9891\u6587\u4ef6\u5982\u4e0b\uff0c\u5176\u4e2d",(0,i.kt)("inlineCode",{parentName:"p"},"METHOD"),"\u662f\u52a0\u5bc6\u65b9\u5f0f\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"URI"),"\u662f\u52a0\u5bc6\u7684key\u6587\u4ef6\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"IV"),"\u662f\u52a0\u5bc6\u7684\u521d\u59cb\u5411\u91cf\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"EXTINF"),"\u662f\u6bcf\u4e2a\u89c6\u9891\u7684\u65f6\u957f"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'#EXTM3U\n#EXT-X-VERSION:3\n#EXT-X-TARGETDURATION:19\n#EXT-X-MEDIA-SEQUENCE:0\n#EXT-X-KEY:METHOD=AES-128,URI="enc.key",IV=0x00000000000000000000000000000000\n#EXTINF:10.416667,\nhttps://hnts.ymuuy.com:65/hls/125/20230802/1817669/plist0.ts\n#EXTINF:10.958333,\nhttps://hnts.ymuuy.com:65/hls/125/20230802/1817669/plist1.ts\n#EXTINF:10.125000,\nhttps://hnts.ymuuy.com:65/hls/125/20230802/1817669/plist2.ts\n#EXTINF:9.250000,\nhttps://hnts.ymuuy.com:65/hls/125/20230802/1817669/plist3.ts\n...\n')),(0,i.kt)("h2",{id:"\u83b7\u53d6m3u8\u6587\u4ef6\u5e76\u4fdd\u5b58"},"\u83b7\u53d6m3u8\u6587\u4ef6\u5e76\u4fdd\u5b58"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-py"},'def getM3u8(iframeUrl):\n    response = requests.get(iframeUrl, headers)\n    response.encoding = "utf-8"\n    regex = re.compile(r"url: \'(?P<m3u8Url>.*?)\',", re.S)\n    m3u8Url = regex.search(response.text).group("m3u8Url")\n    res = requests.get(m3u8Url, headers)\n    with open("./m3u8.m3u8", "wb") as f:\n        f.write(res.content)\n')),(0,i.kt)("h2",{id:"\u901a\u8fc7\u5f02\u6b65\u7f16\u7a0b\u4e0b\u8f7d\u6240\u6709\u7684ts\u5206\u6bb5\u6587\u4ef6"},"\u901a\u8fc7\u5f02\u6b65\u7f16\u7a0b\u4e0b\u8f7d\u6240\u6709\u7684ts\u5206\u6bb5\u6587\u4ef6"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-py"},'async def download(url):\n    for i in range(1, 10):\n        try:\n            async with aiohttp.ClientSession() as session:\n                async with session.get(url) as resp:\n                    content = await resp.content.read()\n                    filename = url.split("/")[-1]\n                    async with aiofiles.open(\n                        f"./\u7535\u5f71/{filename}", mode="wb"\n                    ) as f:\n                        print("\u5f00\u59cb\u5199\u5165", url)\n                        await f.write(content)\n            print("\u4e0b\u8f7d\u6210\u529f", url)\n            break\n        except:\n            print("\u4e0b\u8f7d\u5931\u8d25", url)\n            await asyncio.sleep((i + 1) * 5)\n            break\n\nasync def downMovie():\n    tasks = []\n    with open("./m3u8.m3u8", "r") as f:\n        lines = f.readlines()\n        for line in lines:\n            if ".ts" in line:\n                url = line.strip()\n                tasks.append(asyncio.ensure_future(download(url)))\n        await asyncio.gather(*tasks)\n')),(0,i.kt)("p",null,"ps:\u5728\u8fd9\u91cc\uff0c\u540c\u65f6\u53d1\u9001\u592a\u591a\u6587\u4ef6\u53ef\u80fd\u5bfc\u81f4\u5931\u8d25\uff0c\u5982\u679c\u4e0b\u8f7d\u5931\u8d25\uff0c\u8bf7\u7b49\u5f85\u51e0\u79d2\u949f\uff0c\u7136\u540e\u91cd\u65b0\u4e0b\u8f7d\u3002"),(0,i.kt)("h2",{id:"\u4e0b\u8f7d\u5b8c\u6210\u540e\u89e3\u5bc6ts\u6587\u4ef6"},"\u4e0b\u8f7d\u5b8c\u6210\u540e\u89e3\u5bc6ts\u6587\u4ef6"),(0,i.kt)("p",null,"\u5b89\u88c5pycryptodome"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"pip install pycryptodome\n")),(0,i.kt)("p",null,"\u901a\u8fc7",(0,i.kt)("inlineCode",{parentName:"p"},"from Crypto.Cipher import AES"),"\u5f15\u5165",(0,i.kt)("inlineCode",{parentName:"p"},"AES"),"\u89e3\u5bc6ts\u6587\u4ef6"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-py"},'headers = {\n    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"\n}\n\n\ndef getKey(url):\n    res = requests.get(url)\n    return res.text\n\n# \u5f02\u6b65\u89e3\u5bc6ts\u6587\u4ef6\nasync def decodeTs(file, key):\n    print("\u5f00\u59cb\u89e3\u5bc6", file)\n    aes = AES.new(\n        key=key.encode(),\n        IV=b"0000000000000000",\n        mode=AES.MODE_CBC,\n    )\n    async with aiofiles.open(f"\u7535\u5f71/{file}", "rb") as f, aiofiles.open(\n        f"\u7535\u5f71\u89e3\u5bc6/{file}", "wb"\n    ) as fw:\n        content = await f.read()\n        bsCon = aes.decrypt(content)\n        await fw.write(bsCon)\n        print("\u89e3\u5bc6\u5b8c\u6210", file)\n\n# \u8bfb\u53d6m3u8\u6587\u4ef6\uff0c\u83b7\u53d6key\u5e76\u6839\u636ekey\u89e3\u5bc6ts\u6587\u4ef6\nasync def main():\n    keyUrl = ""\n    IV = ""\n    tasks = []\n    with open("./m3u8.m3u8", "r", encoding="utf-8") as f:\n        lines = f.readlines()\n        urls = "".join(lines)\n\n        regex = re.compile(r\'URI="(?P<keyUrl>.*?)"\')\n        keyUrl = regex.search(urls).group("keyUrl")\n        keyUrl = "https://hnzy.bfvvs.com/play/YaOR6mBe/enc.key"\n\n        regexIv = re.compile(r"IV=(?P<IV>.*?)\\n")\n        IV = regexIv.search(urls).group("IV")\n        key = getKey(keyUrl)\n        for line in lines:\n            if ".ts" in line:\n                tasks.append(decodeTs(line.split("/")[-1].strip(), key, IV))\n    await asyncio.gather(*tasks)\n')),(0,i.kt)("h2",{id:"\u628a\u89e3\u5bc6\u540e\u7684ts\u6587\u4ef6\u5408\u5e76\u6210mp4"},"\u628a\u89e3\u5bc6\u540e\u7684ts\u6587\u4ef6\u5408\u5e76\u6210mp4"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'def mergeMovive():\n    urls = []\n    with open("./m3u8.m3u8", "r", encoding="utf-8") as f:\n        for line in f:\n            if ".ts" in line:\n                urls.append(line.split("/")[-1].strip())\n    temp = []\n    n = 1\n    for i in range(len(urls)):\n        name = urls[i]\n        temp.append(f".\\\\\u7535\u5f71\u89e3\u5bc6\\\\{name}")\n        if i != 0 and i % 50 == 0:\n            names = "+".join(temp)\n            os.system(f"copy /b {names} {n}.ts")\n            n += 1\n            temp = []\n    names = "+".join(temp)\n    os.system(f"copy /b {names} {n}.ts")\n    n+=1\n    tempm = []\n    for i in range(1, n):\n        tempm.append(f"{i}.ts")\n    print(tempm)\n    namem = "+".join(tempm)\n    print(namem)\n    os.system(f"copy /b {namem} movie.mp4")\n')),(0,i.kt)("p",null,"ps"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u4f7f\u7528",(0,i.kt)("inlineCode",{parentName:"li"},"os.system"),"\u5408\u5e76\u6587\u4ef6\u65f6\u8def\u5f84\u4e0d\u80fd\u592a\u957f\uff0c\u53ef\u5206\u6279\u5408\u5e76"),(0,i.kt)("li",{parentName:"ul"},"linx\u5408\u5e76\u8bed\u6cd5\u4e3a",(0,i.kt)("inlineCode",{parentName:"li"},"cat file1 file2 > newfile"),",windows\u5408\u5e76\u8bed\u6cd5\u4e3a",(0,i.kt)("inlineCode",{parentName:"li"},"copy /b file1+file2 newfile")),(0,i.kt)("li",{parentName:"ul"},"\u5728windos\u4e0a\u5408\u5e76\u65f6\u4f7f\u7528",(0,i.kt)("inlineCode",{parentName:"li"},"cmd"))))}c.isMDXComponent=!0}}]);